<!DOCTYPE html>
<html>
<head>
    <title>Library Traffic Data Retriever</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        input, button { margin: 10px 0; padding: 5px; width: 100%; }
        #results { margin-top: 20px; border: 1px solid #ddd; padding: 10px; }
        #errorMsg { color: red; }
    </style>
</head>
<body>
    <h1>Library Traffic Data Retriever</h1>
    
    <label for="client_id">Client ID (APIKEY):</label>
    <input type="text" id="client_id" placeholder="Enter your Client ID">
    
    <label for="start_date">Start Date (YYYY-MM-DD):</label>
    <input type="text" id="start_date" value="2025-02-01">
    
    <label for="end_date">End Date (YYYY-MM-DD):</label>
    <input type="text" id="end_date" value="2025-02-02">
    
    <button id="fetchData">Retrieve Traffic Data</button>
    
    <div id="errorMsg"></div>
    <div id="results"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
    document.getElementById('fetchData').addEventListener('click', function() {
        // Clear previous results and errors
        document.getElementById('errorMsg').innerText = '';
        document.getElementById('results').innerHTML = '';

        // Get input values
        const clientId = document.getElementById('client_id').value.trim();
        const startDate = document.getElementById('start_date').value.trim();
        const endDate = document.getElementById('end_date').value.trim();

        // Basic validation
        if (!clientId) {
            document.getElementById('errorMsg').innerText = 'Please enter a Client ID';
            return;
        }

        // Convert dates to ISO format
        const startISO = new Date(startDate).toISOString();
        const endISO = new Date(endDate).toISOString();

        // Make AJAX call
        $.ajax({
            url: "https://vea.sensourceinc.com/api/data/traffic",
            method: "GET",
            headers: {
                "Content-Type": "application/json",
                "APIKEY": clientId
            },
            data: {
                "relativeDate": "custom",
                "startDate": startISO,
                "endDate": endISO,
                "dateGroupings": "hour",
                "entityType": "zone"
            },
            success: function(resp) {
                // Create a table to display results
                let resultsHtml = '<h2>Retrieved Data</h2>';
                resultsHtml += '<p>Total Records: ' + (resp.results ? resp.results.length : 0) + '</p>';
                
                if (resp.results && resp.results.length > 0) {
                    resultsHtml += '<table border="1" style="width:100%; border-collapse: collapse;">';
                    resultsHtml += '<tr><th>Name</th><th>Date</th><th>Entries</th><th>Exits</th></tr>';
                    
                    resp.results.forEach(function(record) {
                        resultsHtml += `<tr>
                            <td>${record.name || 'Unknown'}</td>
                            <td>${record.recordDate_hour_1 || 'N/A'}</td>
                            <td>${record.sumins || 0}</td>
                            <td>${record.sumouts || 0}</td>
                        </tr>`;
                    });
                    
                    resultsHtml += '</table>';
                } else {
                    resultsHtml += '<p>No data found for the selected date range.</p>';
                }

                document.getElementById('results').innerHTML = resultsHtml;
            },
            error: function(xhr, status, err) {
                // Display error details
                let errorMessage = 'Error retrieving data: ';
                
                if (xhr.responseJSON && xhr.responseJSON.message) {
                    errorMessage += xhr.responseJSON.message;
                } else {
                    errorMessage += err || 'Unknown error';
                }

                document.getElementById('errorMsg').innerText = errorMessage;
                console.error('Full error:', xhr);
            }
        });
    });
    </script>
</body>
</html>
