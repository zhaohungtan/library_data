<!DOCTYPE html>
<html>
<head>
  <title>VEA API Test</title>
  <meta charset="utf-8">
  <!-- jQuery for easy AJAX calls -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    label { display: block; margin-top: 10px; }
    input { margin-bottom: 10px; }
    pre { background: #f4f4f4; padding: 10px; border: 1px solid #ddd; }
    .error { color: red; }
  </style>
</head>
<body>
  <h1>VEA API Test</h1>
  <div id="errorMsg" class="error"></div>
  
  <label>Client ID:</label>
  <input type="text" id="client_id" placeholder="Enter your client ID">
  
  <label>Client Secret:</label>
  <input type="password" id="client_secret" placeholder="Enter your client secret">
  
  <label>Start Date (YYYY-MM-DD):</label>
  <input type="text" id="start_date" value="2025-02-01">
  
  <label>End Date (YYYY-MM-DD):</label>
  <input type="text" id="end_date" value="2025-02-02">
  
  <button id="testButton">Test Get Data</button>
  
  <h2>Output:</h2>
  <pre id="output"></pre>
  
  <script>
    $(document).ready(function(){
      $("#testButton").click(function(){
        // Clear any previous messages
        $("#output").text("");
        $("#errorMsg").text("");
        
        var client_id = $("#client_id").val().trim();
        var client_secret = $("#client_secret").val().trim();
        var start_date = $("#start_date").val().trim();
        var end_date = $("#end_date").val().trim();
        
        if (!client_id || !client_secret) {
          $("#errorMsg").text("Please enter both Client ID and Client Secret.");
          return;
        }
        
        function validDate(str) {
          return !isNaN(new Date(str).getTime());
        }
        
        if (!validDate(start_date) || !validDate(end_date)) {
          $("#errorMsg").text("Please provide valid dates in YYYY-MM-DD format.");
          return;
        }
        
        var startISO = new Date(start_date).toISOString();
        var endISO = new Date(end_date).toISOString();
        
        // Step 1: Obtain the access token
        $.ajax({
          url: "https://auth.sensourceinc.com/oauth/token",
          method: "POST",
          contentType: "application/json",
          data: JSON.stringify({
            "grant_type": "client_credentials",
            "client_id": client_id,
            "client_secret": client_secret
          }),
          success: function(tokenResponse) {
            var access_token = tokenResponse.access_token;
            
            // Step 2: Use the token to fetch traffic data
            $.ajax({
              url: "https://vea.sensourceinc.com/api/data/traffic",
              method: "GET",
              headers: {
                "Content-Type": "application/json",
                "Authorization": "Bearer " + access_token
              },
              data: {
                "relativeDate": "custom",
                "startDate": startISO,
                "endDate": endISO,
                "dateGroupings": "hour",
                "entityType": "zone"
              },
              success: function(dataResponse) {
                // Display the JSON response in a formatted way
                $("#output").text(JSON.stringify(dataResponse, null, 2));
              },
              error: function(xhr, status, err) {
                $("#errorMsg").text("Error fetching traffic data: " + err);
              }
            });
          },
          error: function(xhr, status, err) {
            $("#errorMsg").text("Error fetching access token: " + err);
          }
        });
      });
    });
  </script>
</body>
</html>
