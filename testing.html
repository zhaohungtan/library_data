<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Library Traffic Data Retriever</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 600px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        input, button { 
            width: 100%; 
            padding: 10px; 
            margin: 10px 0; 
        }
        #results {
            margin-top: 20px;
            border: 1px solid #ddd;
            padding: 10px;
            white-space: pre-wrap;
            word-wrap: break-word;
            background-color: #f4f4f4;
        }
    </style>
</head>
<body>
    <h1>Library Traffic Data Retriever</h1>
    
    <label for="client_id">Client ID:</label>
    <input type="text" id="client_id" placeholder="Enter Client ID">
    
    <label for="client_secret">Client Secret:</label>
    <input type="password" id="client_secret" placeholder="Enter Client Secret">
    
    <label for="start_date">Start Date (YYYY-MM-DD):</label>
    <input type="text" id="start_date" value="2025-02-01" placeholder="YYYY-MM-DD">
    
    <label for="end_date">End Date (YYYY-MM-DD):</label>
    <input type="text" id="end_date" value="2025-02-02" placeholder="YYYY-MM-DD">
    
    <button id="fetchData">Retrieve Data</button>
    
    <div id="results"></div>

    <script>
    document.getElementById('fetchData').addEventListener('click', async function() {
        // Get input values
        const clientId = document.getElementById('client_id').value.trim();
        const clientSecret = document.getElementById('client_secret').value.trim();
        const startDate = document.getElementById('start_date').value.trim();
        const endDate = document.getElementById('end_date').value.trim();
        const resultsDiv = document.getElementById('results');

        // Clear previous results
        resultsDiv.innerHTML = 'Fetching data...';

        try {
            // Step 1: Get Access Token
            const tokenResponse = await fetch('https://auth.sensourceinc.com/oauth/token', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    grant_type: 'client_credentials',
                    client_id: clientId,
                    client_secret: clientSecret
                })
            });

            if (!tokenResponse.ok) {
                throw new Error('Authentication failed');
            }

            const tokenData = await tokenResponse.json();
            const accessToken = tokenData.access_token;

            // Step 2: Fetch Traffic Data
            const dataResponse = await fetch('https://vea.sensourceinc.com/api/data/traffic', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${accessToken}`
                },
                params: {
                    relativeDate: 'custom',
                    startDate: new Date(startDate).toISOString(),
                    endDate: new Date(endDate).toISOString(),
                    dateGroupings: 'hour',
                    entityType: 'zone'
                }
            });

            if (!dataResponse.ok) {
                throw new Error('Failed to retrieve traffic data');
            }

            const trafficData = await dataResponse.json();

            // Format and display results
            resultsDiv.innerHTML = JSON.stringify(trafficData.results, null, 2);

        } catch (error) {
            resultsDiv.innerHTML = `Error: ${error.message}`;
            console.error('Detailed error:', error);
        }
    });
    </script>
</body>
</html>
