<!DOCTYPE html>
<html>
<head>
    <title>VEA API Simple Data Retriever</title>
    <meta charset="utf-8">
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        input, button { 
            margin: 10px 0; 
            padding: 5px; 
            width: 100%; 
        }
        #results { 
            margin-top: 20px; 
            border: 1px solid #ddd; 
            padding: 10px; 
        }
        #errorMsg { 
            color: red; 
        }
        table { 
            width: 100%; 
            border-collapse: collapse; 
        }
        th, td { 
            border: 1px solid #ddd; 
            padding: 8px; 
            text-align: left; 
        }
    </style>
</head>
<body>
    <h1>VEA API Data Retriever</h1>
    
    <label for="client_id">Client ID (APIKEY):</label>
    <input type="text" id="client_id" placeholder="Enter your Client ID">
    
    <button id="fetchTrafficData">Fetch All Traffic Data</button>
    
    <div id="errorMsg"></div>
    <div id="results"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
    document.getElementById('fetchTrafficData').addEventListener('click', function() {
        // Clear previous results and errors
        document.getElementById('errorMsg').innerText = '';
        document.getElementById('results').innerHTML = '';

        // Get input values
        const clientId = document.getElementById('client_id').value.trim();

        // Basic validation
        if (!clientId) {
            document.getElementById('errorMsg').innerText = 'Please enter Client ID';
            return;
        }

        // Make AJAX call to fetch traffic data directly
        $.ajax({
            url: "https://vea.sensourceinc.com/api/data/traffic",
            method: "GET",
            headers: {
                "Content-Type": "application/json",
                "APIKEY": clientId
            },
            data: {
                "relativeDate": "today"
            },
            success: function(resp) {
                // Create a table to display results
                let resultsHtml = '<h2>Traffic Data</h2>';
                resultsHtml += `<p>Total Records: ${resp.results ? resp.results.length : 0}</p>`;
                
                if (resp.results && resp.results.length > 0) {
                    resultsHtml += '<table>';
                    resultsHtml += '<tr><th>Zone Name</th><th>Date</th><th>Zone ID</th><th>Entries</th><th>Exits</th></tr>';
                    
                    resp.results.forEach(function(record) {
                        resultsHtml += `<tr>
                            <td>${record.name || 'Unknown'}</td>
                            <td>${record.recordDate || record.recordDate_hour_1 || 'N/A'}</td>
                            <td>${record.zoneId || 'N/A'}</td>
                            <td>${record.sumins || record.ins || 0}</td>
                            <td>${record.sumouts || record.outs || 0}</td>
                        </tr>`;
                    });
                    
                    resultsHtml += '</table>';
                } else {
                    resultsHtml += '<p>No data found for today.</p>';
                }

                document.getElementById('results').innerHTML = resultsHtml;
            },
            error: function(xhr, status, err) {
                // Display error details
                let errorMessage = 'Error retrieving traffic data: ';
                
                if (xhr.responseJSON && xhr.responseJSON.message) {
                    errorMessage += xhr.responseJSON.message;
                } else {
                    errorMessage += err || 'Unknown error';
                }

                document.getElementById('errorMsg').innerText = errorMessage;
                console.error('Full error:', xhr);
            }
        });
    });
    </script>
</body>
</html>
